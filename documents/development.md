# 项目概述

本系统旨在为用户提供通过歌词进行英文学习的产品体验，涵盖歌曲搜索、歌词与注解智能展示、词汇与句型分析、学习进度追踪和丰富的交互式扩展。

# 技术架构总览

- 前端/全栈：Next.js 16 (App Router) + React 19 + TypeScript
- 数据库：PostgreSQL（可选择 Neon、Supabase 或自托管），ORM 使用 Prisma
- 包管理：Bun
- UI 组件库：shadcn/ui + Tailwind CSS
- 用户认证：Clerk（OAuth + Email）
- 搜索：PostgreSQL tsvector + GIN 索引（全文检索词曲等资源）

# 主要业务流程

- 用户搜索入口
  - 用户输入“歌曲名”或“艺人名”；
  - 前端通过 Next.js API 路由调用后端；
  - 优先检索本地数据库，未命中则请求Genius API；
  - 歌词无法直接通过genius api获取，可通过 `https://lyrics.zick.me/lyrics?path=/Guns-n-roses-november-rain-lyrics` 获取歌曲的歌词；
  - 新资源自动回流数据库缓存（实时/异步，后端同步逻辑）。
- 歌词页结构
  - 显示歌曲基础信息（歌名、艺人、专辑、年等）；
  - 歌词正文分段高亮，每句支持点击查看注解、解析；
  - 右侧栏/浮窗区展示 Genius annotations/referents 并自动锚点关联歌词对应段落；
  - 词汇/句型分析（可选词典API、AI解析模块辅助）；
- 支持媒体扩展：嵌入 MV、演唱视频等外部资源；
- 学习与数据追踪
  - 用户选中单词、句型自动弹窗详细释义、加入生词本等操作；
  - 支持用户打卡、收藏、已学进度分析与可视化（进度条、成就系统）；
  - 所有交互数据结构化落库，为复习和智能复现做准备。

# 模块划分及关键技术细节

1. 前端应用
  - 基于 Next.js 16 App Router，页面和 API 路由严格拆分。
  - React 19 + TypeScript 保障类型安全和UI表现力。
  - 使用 shadcn/ui + Tailwind CSS 进行快速 UI 搭建，样式与交互规范统一。
  - 登录与权限通过 Clerk 组件完成，无感OAuth及邮箱一键体验。
  - 歌词区、注解区、词汇弹窗均采用组件解耦、可复用、响应式布局。

2. 后端与存储
  - API 路由用 Next.js 的 app/api 文件夹开发，集中管理外部API对接、数据库操作、缓存刷新逻辑。
  - 数据库模式：
    - 歌曲表（songs）：包含基本信息、歌手、专辑、年份等字段
    - 歌词表（lyrics）：歌词原文、时间戳、分行分段、歌曲ID外键
    - 注解表（annotations）：Genius结构化注解（content、referent、定位范围等）、关联歌词字段
    - 用户表（users）及相关词汇、收藏表
    - 生词本表（wordbook）：关联用户、高亮单词及学习状态
    - 进度统计表（progress）：学习天数、打卡记录

ORM 采用 Prisma，数据库代码类型安全、迁移方便，模型支持扩展。

3. 搜索引擎实现
PostgreSQL 利用 tsvector + GIN 索引对歌曲、艺人、歌词原文和注解内容做全文索引，前端可体验智能模糊搜索、拼写容错、热词建议等功能。

支持多条件联合（如歌名+艺人、歌词关键词等）。

4. 用户认证
Clerk 配置多种第三方登录（Google、Github、Apple等），支持邮箱注册登录。

所有收藏、学习进度实时绑定用户身份，保障数据隔离与安全。

5. 性能优化与安全
常用热门歌词与注解主动缓存（Redis、本地缓存或Edge函数视实际访问量部署）。

资源请求带限流和异常处理，防止 API 滥用/数据拉爆。

数据库逐步做冷热分层存储（如历史学习数据归档）。

架构和业务流程图参考
参见流程图开发架构Mermaid范例（见前面回答，可贴到md渲染平台或文档），不限于：用户输入 → 歌曲资源检索 → 歌词页面渲染（歌词/注解/词汇）→ 学习记录存库。

# 后续建议

- 可将词汇关联自动调用词典或AI释义（如 ChatGPT/Claude API）实时补充解释和扩展例句。
- 对注解/文化习惯增加多媒体关联，提升场景式学习体验。
- 用户模块支持错题/生词复习算法，推动记忆曲线优化复习体验。
- 增加接口健康监控和学习数据分析看板，助力用户习惯优化和增长。